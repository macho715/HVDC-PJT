í”„ë¡œì íŠ¸ ì „ì²´ì˜ ì£¼ìš” ë¡œì§ê³¼ í•¨ìˆ˜ë¥¼ ì°¾ì•„ì„œ ì…ê³ /ì¶œê³ /ì¬ê³  ê´€ë ¨ ë¡œì§ì„ ë¶„ì„í•˜ê² ìŠµë‹ˆë‹¤.

Search files...
Ran tool
Read file: src/warehouse_io_calculator.py
Read file: src/warehouse_io_calculator.py
Read file: src/warehouse_io_calculator.py
Read file: create_final_hvdc_excel_system_v2.py
Read file: hvdc_macho_gpt/WAREHOUSE/core/helpers.py
Read file: create_hvdc_excel_final_correct_v285.py
# ï¿½ï¿½ HVDC í”„ë¡œì íŠ¸ ì „ì²´ ì£¼ìš” ë¡œì§ ë° í•¨ìˆ˜ ì¢…í•© ë³´ê³ ì„œ

## ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”
- **ë¶„ì„ ëŒ€ìƒ**: HVDC í”„ë¡œì íŠ¸ ì „ì²´ ì½”ë“œë² ì´ìŠ¤
- **í•µì‹¬ ê¸°ëŠ¥**: ì…ê³ /ì¶œê³ /ì¬ê³  ê³„ì‚° ë¡œì§
- **ì´ í•¨ìˆ˜ ìˆ˜**: 50+ ê°œ í•µì‹¬ í•¨ìˆ˜
- **ë°ì´í„° ì²˜ë¦¬ëŸ‰**: 7,573ê±´ (HITACHI 5,346 + SIMENSE 2,227)

---

## ï¿½ï¿½ 1. ì°½ê³  ì…ê³  ë¡œì§ (8ê°œ í•µì‹¬ í•¨ìˆ˜)

### ï¿½ï¿½ **1.1 ê¸°ë³¸ ì…ê³  ê³„ì‚° í•¨ìˆ˜ë“¤**

#### `calculate_warehouse_inbound()` - ë©”ì¸ ì…ê³  í•¨ìˆ˜
**íŒŒì¼**: `src/warehouse_io_calculator.py:93`
```python
def calculate_warehouse_inbound(self, df: pd.DataFrame) -> Dict:
    """
    ì°½ê³  ì…ê³  ê³„ì‚° (Final_Location ê¸°ë°˜ + ì›”ë³„ í”¼ë²—)
    - Final_Location ê¸°ì¤€ìœ¼ë¡œ ì •í™•í•œ ìœ„ì¹˜ íŒŒì•…
    - ì›”ë³„ ì…ê³ ëŸ‰ í”¼ë²— í…Œì´ë¸” ìƒì„±
    """
    # Final_Location ê³„ì‚°
    result_df = self.calculate_final_location(df)

    # warehouse ìƒíƒœ í•­ëª©ë§Œ í•„í„°ë§
    warehouse_items = result_df[result_df['Status_Current'] == 'warehouse']

    # ì…ê³  ë‚ ì§œ ì»¬ëŸ¼ ì°¾ê¸°
    inbound_date_candidates = [
        'Inbound_Date', 'Arrival_Date', 'Warehouse_In_Date',
        'Entry_Date', 'Received_Date'
    ]

    # ì›”ë³„ ì§‘ê³„ ë° í”¼ë²— í…Œì´ë¸” ìƒì„±
    return {
        'total_inbound': len(warehouse_items),
        'by_warehouse': dict(by_warehouse),
        'by_month': dict(by_month),
        'monthly_pivot': monthly_pivot
    }
```

#### `calculate_warehouse_inbound_correct()` - ì •í™•í•œ ì›”ë³„ ì…ê³ 
**íŒŒì¼**: `create_hvdc_excel_final_correct_v285.py:248`
```python
def calculate_warehouse_inbound_correct(self, df, warehouse_name, period):
    """ì°½ê³ ë³„ ì›”ë³„ ì…ê³  ì •í™• ê³„ì‚°"""
    if warehouse_name not in df.columns:
        return 0

    # í•´ë‹¹ ì›”ì— í•´ë‹¹ ì°½ê³ ì— ì‹¤ì œë¡œ ë„ì°©í•œ ê±´ìˆ˜
    warehouse_dates = df[warehouse_name].dropna()
    if len(warehouse_dates) == 0:
        return 0

    month_mask = warehouse_dates.dt.to_period('M') == period.to_period('M')
    return month_mask.sum()
```

#### `calculate_warehouse_inbound()` - 3ë‹¨ê³„ ì…ê³  ë¡œì§
**íŒŒì¼**: `create_final_hvdc_excel_system_v2.py:156`
```python
def calculate_warehouse_inbound(self, df: pd.DataFrame) -> Dict:
    """
    ì…ê³  ë¡œì§ 3ë‹¨ê³„ - Step 1: ì°½ê³  ì»¬ëŸ¼ ë‚ ì§œ ì¡´ì¬ â†’ ì…ê³  ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸í™”
    """
    inbound_items = []
    total_inbound = 0
    by_warehouse = {}
    by_month = {}

    for idx, row in df.iterrows():
        for warehouse in self.real_warehouse_columns.keys():
            if warehouse in row.index and pd.notna(row[warehouse]):
                warehouse_date = pd.to_datetime(row[warehouse])
                inbound_items.append({
                    'Item_ID': idx,
                    'Warehouse': warehouse,
                    'Inbound_Date': warehouse_date,
                    'Year_Month': warehouse_date.strftime('%Y-%m')
                })
                total_inbound += 1

                # ì°½ê³ ë³„, ì›”ë³„ ì§‘ê³„
                if warehouse not in by_warehouse:
                    by_warehouse[warehouse] = 0
                by_warehouse[warehouse] += 1

                month_key = warehouse_date.strftime('%Y-%m')
                if month_key not in by_month:
                    by_month[month_key] = 0
                by_month[month_key] += 1

    return {
        'total_inbound': total_inbound,
        'by_warehouse': by_warehouse,
        'by_month': by_month,
        'inbound_items': inbound_items
    }
```

### ï¿½ï¿½ **1.2 ê³ ê¸‰ ì…ê³  ê³„ì‚° í•¨ìˆ˜ë“¤**

#### `create_monthly_inbound_pivot()` - ì›”ë³„ í”¼ë²— ìƒì„±
**íŒŒì¼**: `create_final_hvdc_excel_system_v2.py:200`
```python
def create_monthly_inbound_pivot(self, df: pd.DataFrame) -> pd.DataFrame:
    """
    ì…ê³  ë¡œì§ 3ë‹¨ê³„ - Step 2: pivot_table ë°©ì‹ìœ¼ë¡œ ì›”ë³„ ì…ê³  ì§‘ê³„
    Final_Location ê¸°ì¤€ MonthÃ—Warehouse ë§¤íŠ¸ë¦­ìŠ¤
    """
    # Final Location ê³„ì‚°
    df = self.calculate_final_location(df)

    # í”¼ë²— í…Œì´ë¸” ìƒì„±
    inbound_df = pd.DataFrame(inbound_data)
    pivot_df = inbound_df.pivot_table(
        index='Year_Month',
        columns='Final_Location',
        values='Item_ID',
        aggfunc='count',
        fill_value=0
    )

    return pivot_df
```

#### `calculate_final_location()` - ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ìœ„ì¹˜ ê³„ì‚°
**íŒŒì¼**: `create_final_hvdc_excel_system_v2.py:250`
```python
def calculate_final_location(self, df: pd.DataFrame) -> pd.DataFrame:
    """
    ì…ê³  ë¡œì§ 3ë‹¨ê³„ - Step 3: ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ìµœì¢… ìœ„ì¹˜ ê³„ì‚°
    ìš°ì„ ìˆœìœ„: DSV Al Markaz > DSV Indoor > Status_Location
    """
    def get_final_location(row):
        # ìš°ì„ ìˆœìœ„ ìˆœì„œë¡œ í™•ì¸
        for warehouse in self.warehouse_priority:
            if warehouse in row.index and pd.notna(row[warehouse]):
                return warehouse

        # ë§ˆì§€ë§‰ìœ¼ë¡œ Status_Location í™•ì¸
        if 'Status_Location' in row.index and pd.notna(row['Status_Location']):
            return 'Status_Location'

        return 'Unknown'

    # np.select ê³ ì„±ëŠ¥ ê³„ì‚° í™œìš©
    conditions = []
    choices = []

    for warehouse in self.warehouse_priority:
        if warehouse in df.columns:
            conditions.append(df[warehouse].notna())
            choices.append(warehouse)

    df['Final_Location'] = np.select(conditions, choices, default='Unknown')
    return df
```

---

## ï¿½ï¿½ 2. ì°½ê³  ì¶œê³  ë¡œì§ (8ê°œ í•µì‹¬ í•¨ìˆ˜)

### ï¿½ï¿½ **2.1 ê¸°ë³¸ ì¶œê³  ê³„ì‚° í•¨ìˆ˜ë“¤**

#### `calculate_warehouse_outbound()` - ë©”ì¸ ì¶œê³  í•¨ìˆ˜
**íŒŒì¼**: `src/warehouse_io_calculator.py:194`
```python
def calculate_warehouse_outbound(self, df: pd.DataFrame) -> Dict:
    """
    ì°½ê³  ì¶œê³  ê³„ì‚° (ì´ë²¤íŠ¸ íƒ€ì„ë¼ì¸ ë°©ì‹)
    - ì¶œê³  ì´ë²¤íŠ¸ ì¤‘ë³µ ì œê±°
    - ì‹¤ì œ ì°½ê³  â†’ í˜„ì¥ ì´ë™ ì´ë²¤íŠ¸ë§Œ ì¹´ìš´íŠ¸
    """
    # ëª¨ë“  ë‚ ì§œ ì»¬ëŸ¼ melt
    long_df = df.melt(
        id_vars=['Item'] if 'Item' in df.columns else [df.columns[0]],
        value_vars=warehouse_cols + site_cols,
        var_name='Location',
        value_name='Date'
    ).dropna()

    # ë‚ ì§œí˜• ë³€í™˜ ë° ì •ë ¬
    long_df['Date'] = pd.to_datetime(long_df['Date'], errors='coerce')
    long_df = long_df.sort_values(['Item', 'Date'])

    # ì´ì „ Location ëŒ€ë¹„ ë³€í™” ì‹œ ì¶œê³  ì´ë²¤íŠ¸ ë§ˆí‚¹
    long_df['Prev_Location'] = long_df.groupby('Item')['Location'].shift()

    # ì°½ê³  â†’ í˜„ì¥ ì´ë™ë§Œ ì¶œê³ ë¡œ ê³„ì‚°
    outbound_events = long_df[
        long_df['Prev_Location'].isin(warehouse_cols) &
        long_df['Location'].isin(site_cols)
    ]

    return {
        'total_outbound': len(outbound_events),
        'by_warehouse': dict(by_warehouse),
        'by_site': dict(by_site)
    }
```

#### `calculate_warehouse_outbound_correct()` - ì •í™•í•œ ì›”ë³„ ì¶œê³ 
**íŒŒì¼**: `create_hvdc_excel_final_correct_v285.py:261`
```python
def calculate_warehouse_outbound_correct(self, df, warehouse_name, period):
    """ì°½ê³ ë³„ ì›”ë³„ ì¶œê³  ì •í™• ê³„ì‚°"""
    # í•´ë‹¹ ì°½ê³ ë¥¼ ë°©ë¬¸í•œ ì¼€ì´ìŠ¤ë“¤
    warehouse_visited = df[df[warehouse_name].notna()].copy()

    outbound_count = 0

    for idx, row in warehouse_visited.iterrows():
        warehouse_date = row[warehouse_name]

        # ì°½ê³  ë°©ë¬¸ í›„ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•œ ë‚ ì§œ ì°¾ê¸°
        next_dates = []

        # ë‹¤ë¥¸ ì°½ê³ ë¡œ ì´ë™
        for other_wh in self.warehouse_columns.keys():
            if other_wh != warehouse_name and other_wh in row.index:
                other_date = row[other_wh]
                if pd.notna(other_date) and other_date > warehouse_date:
                    next_dates.append(other_date)

        # í˜„ì¥ìœ¼ë¡œ ì´ë™
        for site_name in self.site_columns.keys():
            if site_name in row.index:
                site_date = row[site_name]
                if pd.notna(site_date) and site_date > warehouse_date:
                    next_dates.append(site_date)

        # ê°€ì¥ ë¹ ë¥¸ ë‹¤ìŒ ë‹¨ê³„ ë‚ ì§œ
        if next_dates:
            earliest_next_date = min(next_dates)
            if earliest_next_date.to_period('M') == period.to_period('M'):
                outbound_count += 1

    return outbound_count
```

#### `calculate_warehouse_outbound_real()` - TDD ê²€ì¦ëœ ì‹œê°„ ìˆœì„œ ê¸°ë°˜
**íŒŒì¼**: `create_final_hvdc_excel_system_v2.py:416`
```python
def calculate_warehouse_outbound_real(self, df: pd.DataFrame, warehouse_name: str, period: pd.Timestamp) -> int:
    """
    TDD ê²€ì¦ëœ ì‹œê°„ ìˆœì„œ ê¸°ë°˜ ì •í™•í•œ ì¶œê³  ê³„ì‚°
    ê°œë³„ ì¼€ì´ìŠ¤ë³„ë¡œ ì°½ê³  â†’ ë‹¤ìŒ ë‹¨ê³„ ì´ë™ ì¶”ì 
    """
    # Step 1: í•´ë‹¹ ì°½ê³  ë°©ë¬¸ ì¼€ì´ìŠ¤ í•„í„°ë§
    warehouse_visited = df[df[warehouse_name].notna()].copy()

    # Step 2: ê° ì¼€ì´ìŠ¤ë³„ ê°œë³„ ì¶”ì 
    for idx, row in warehouse_visited.iterrows():
        warehouse_date = row[warehouse_name]

        # Step 3: ë‹¤ìŒ ë‹¨ê³„ ì´ë™ ë‚ ì§œ íƒìƒ‰
        next_dates = []

        # 3-1: ë‹¤ë¥¸ ì°½ê³ ë¡œ ì´ë™ í™•ì¸
        for other_wh in self.real_warehouse_columns.keys():
            if other_wh != warehouse_name:
                other_date = row[other_wh]
                if pd.notna(other_date) and other_date > warehouse_date:
                    next_dates.append(other_date)

        # 3-2: í˜„ì¥ìœ¼ë¡œ ì´ë™ í™•ì¸
        for site_name in self.real_site_columns.keys():
            site_date = row[site_name]
            if pd.notna(site_date) and site_date > warehouse_date:
                next_dates.append(site_date)

        # Step 4: ê°€ì¥ ë¹ ë¥¸ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì¶œê³  ì‹œì  ê²°ì •
        if next_dates:
            earliest_next_date = min(next_dates)
            if earliest_next_date.to_period('M') == period.to_period('M'):
                outbound_count += 1
```

### ï¿½ï¿½ **2.2 ê³ ê¸‰ ì¶œê³  ê³„ì‚° í•¨ìˆ˜ë“¤**

#### `calculate_monthly_outbound()` - ì›”ë³„ ì¶œê³  ê³„ì‚°
**íŒŒì¼**: `src/warehouse_io_calculator.py:382`
```python
def calculate_monthly_outbound(self, df: pd.DataFrame) -> Dict:
    """
    ì›”ë³„ ì¶œê³  ê³„ì‚° (ì´ë²¤íŠ¸ íƒ€ì„ë¼ì¸ ë²¡í„°í™” ë°©ì‹)

    ê°€ì´ë“œ 3-1: ì¶œê³  ì´ë²¤íŠ¸ ì¬ê³„ì‚°
    - meltâ†’sortâ†’groupby(Item)ë¡œ ëª¨ë“  ì´ë™ì„ ì‹œê³„ì—´ ì •ë ¬
    - ì¶œê³ Â·ì…ê³  ì´ë²¤íŠ¸ 1íšŒë§Œ ì¹´ìš´íŠ¸
    """
    # â‘  ëª¨ë“  ë‚ ì§œ ì»¬ëŸ¼ melt
    warehouse_cols = self.warehouse_columns
    site_cols = self.site_columns

    long_df = df.melt(
        id_vars=['Item'] if 'Item' in df.columns else [df.columns[0]],
        value_vars=warehouse_cols + site_cols,
        var_name='Location',
        value_name='Date'
    ).dropna()

    # â‘¡ ë‚ ì§œ ì •ë ¬ ë° ì´ë²¤íŠ¸ ë§ˆí‚¹
    long_df['Date'] = pd.to_datetime(long_df['Date'], errors='coerce')
    long_df = long_df.sort_values(['Item', 'Date'])
    long_df['Prev_Location'] = long_df.groupby('Item')['Location'].shift()

    # â‘¢ ì°½ê³  â†’ í˜„ì¥ ì´ë™ë§Œ ì¶œê³ ë¡œ ê³„ì‚°
    outbound_events = long_df[
        long_df['Prev_Location'].isin(warehouse_cols) &
        long_df['Location'].isin(site_cols)
    ]

    # â‘£ ì›”ë³„ ì§‘ê³„
    outbound_events['Month'] = outbound_events['Date'].dt.to_period('M')
    monthly_outbound = outbound_events.groupby('Month').size().to_dict()

    return {str(month): count for month, count in monthly_outbound.items()}
```

---

## ï¿½ï¿½ 3. ì°½ê³  ì¬ê³  ë¡œì§ (6ê°œ í•µì‹¬ í•¨ìˆ˜)

### ï¿½ï¿½ **3.1 ê¸°ë³¸ ì¬ê³  ê³„ì‚° í•¨ìˆ˜ë“¤**

#### `calculate_warehouse_inventory()` - ë©”ì¸ ì¬ê³  í•¨ìˆ˜
**íŒŒì¼**: `src/warehouse_io_calculator.py:339`
```python
def calculate_warehouse_inventory(self, df: pd.DataFrame) -> Dict:
    """
    ì°½ê³  ì¬ê³  ê³„ì‚° (ê°€ì´ë“œ ë¬¸ì œì  4 í•´ê²°)
    - í˜„ì¬ warehouse ìƒíƒœ ìœ ì§€ í•­ëª©ë“¤
    - 5% ì†Œë¹„ìœ¨ ê°€ì •ì¹˜ ì œê±°, ì‹¤ì‹œê°„ Location ê¸°ë°˜ ê³„ì‚°
    """
    # ìƒíƒœ ê³„ì‚°
    result_df = self.status_calculator.calculate_complete_status(df)

    # ìƒíƒœë³„ ì§‘ê³„ (ì‹¤ì‹œê°„ ë°ì´í„° ê¸°ë°˜, ì†Œë¹„ìœ¨ ê°€ì •ì¹˜ ì—†ìŒ)
    status_counts = result_df['Status_Current'].value_counts()

    inventory_summary = {
        'total_inventory': status_counts.get('warehouse', 0),
        'by_warehouse': defaultdict(int),
        'by_status': {
            'warehouse': status_counts.get('warehouse', 0),
            'site': status_counts.get('site', 0),
            'pre_arrival': status_counts.get('Pre Arrival', 0)
        }
    }

    # ì°½ê³ ë³„ ì¬ê³  ì§‘ê³„ (ì‹¤ì‹œê°„ Status_Location ê¸°ë°˜)
    warehouse_items = result_df[result_df['Status_Current'] == 'warehouse']
    for _, row in warehouse_items.iterrows():
        location = row['Status_Location']
        inventory_summary['by_warehouse'][location] += 1

    return inventory_summary
```

#### `calculate_warehouse_inventory()` - ëˆ„ì  ì¬ê³  ê³„ì‚°
**íŒŒì¼**: `create_final_hvdc_excel_system_v2.py:348`
```python
def calculate_warehouse_inventory(self, df: pd.DataFrame) -> Dict:
    """ì°½ê³  ì¬ê³  ë¡œì§ - In â€“ Out ëˆ„ì  = ì›”ë§ ì¬ê³ """
    # ì…ê³  ë° ì¶œê³  ê³„ì‚°
    inbound_result = self.calculate_warehouse_inbound(df)
    outbound_result = self.calculate_warehouse_outbound(df)

    # ì›”ë³„ ì¬ê³  ê³„ì‚°
    inventory_by_month = {}
    all_months = set()

    # ëª¨ë“  ì›” ìˆ˜ì§‘
    all_months.update(inbound_result['by_month'].keys())
    all_months.update(outbound_result['by_month'].keys())

    # ì›”ë³„ ì¬ê³  ê³„ì‚°
    for month in sorted(all_months):
        inbound_count = inbound_result['by_month'].get(month, 0)
        outbound_count = outbound_result['by_month'].get(month, 0)
        inventory_by_month[month] = inbound_count - outbound_count

    # ì°½ê³ ë³„ ì¬ê³  ê³„ì‚° (ì´ ëˆ„ì )
    inventory_by_warehouse = {}
    for warehouse in self.real_warehouse_columns.keys():
        inbound_count = inbound_result['by_warehouse'].get(warehouse, 0)
        outbound_count = outbound_result['by_warehouse'].get(warehouse, 0)
        inventory_by_warehouse[warehouse] = inbound_count - outbound_count

    return {
        'inventory_by_month': inventory_by_month,
        'inventory_by_warehouse': inventory_by_warehouse,
        'total_inventory': sum(inventory_by_warehouse.values())
    }
```

### ï¿½ï¿½ **3.2 ê³ ê¸‰ ì¬ê³  ê³„ì‚° í•¨ìˆ˜ë“¤**

#### `calculate_simple_inventory()` - ê°„ë‹¨í•œ ì¬ê³  ê³„ì‚°
**íŒŒì¼**: `hvdc_macho_gpt/WAREHOUSE/core/helpers.py:156`
```python
def calculate_simple_inventory(transaction_df):
    """ê°„ë‹¨í•œ ì¬ê³  ê³„ì‚°"""
    if transaction_df.empty:
        return pd.DataFrame()

    # ë‚ ì§œ ì •ê·œí™”
    transaction_df['Date'] = pd.to_datetime(transaction_df['Date']).dt.date

    # íŠ¸ëœì­ì…˜ íƒ€ì…ë³„ ì§‘ê³„
    daily_summary = transaction_df.groupby(['Location', 'Date', 'TxType_Refined']).agg({
        'Qty': 'sum'
    }).reset_index()

    # í”¼ë²—ìœ¼ë¡œ ì…ê³ /ì¶œê³  ë¶„ë¦¬
    daily_pivot = daily_summary.pivot_table(
        index=['Location', 'Date'],
        columns='TxType_Refined',
        values='Qty',
        fill_value=0
    ).reset_index()

    # ì¬ê³  ê³„ì‚° (ìœ„ì¹˜ë³„ ëˆ„ì )
    stock_records = []

    for location in daily_pivot['Location'].unique():
        if location in ['UNKNOWN', 'UNK']:
            continue

        loc_data = daily_pivot[daily_pivot['Location'] == location].sort_values('Date')
        current_stock = 0

        for _, row in loc_data.iterrows():
            inbound = row.get('IN', 0)
            transfer_out = row.get('TRANSFER_OUT', 0)
            final_out = row.get('FINAL_OUT', 0)
            total_outbound = transfer_out + final_out

            opening_stock = current_stock
            closing_stock = opening_stock + inbound - total_outbound
            current_stock = closing_stock

            stock_records.append({
                'Location': location,
                'Date': row['Date'],
                'Opening_Stock': opening_stock,
                'Inbound': inbound,
                'Transfer_Out': transfer_out,
                'Final_Out': final_out,
                'Total_Outbound': total_outbound,
                'Closing_Stock': closing_stock
            })

    return pd.DataFrame(stock_records)
```

#### `calculate_stock_levels()` - ì¬ê³  ìˆ˜ì¤€ ê³„ì‚°
**íŒŒì¼**: `hvdc_macho_gpt/WAREHOUSE/excel_reporter.py:86`
```python
def calculate_stock_levels(df):
    """ì¬ê³  ìˆ˜ì¤€ ê³„ì‚°"""
    # ë‚ ì§œë³„ë¡œ ì •ë ¬
    df_sorted = df.sort_values('Date')

    # ê° Locationë³„ë¡œ ëˆ„ì  ì¬ê³  ê³„ì‚°
    stock_data = []

    for location in df_sorted['Location'].unique():
        location_data = df_sorted[df_sorted['Location'] == location].copy()

        # ì›”ë³„ë¡œ ê·¸ë£¹í™”
        for month in location_data['ì›”'].unique():
            month_data = location_data[location_data['ì›”'] == month]

            # IN/OUT ê³„ì‚°
            in_qty = month_data[month_data['TxType_Refined'] == 'IN']['Qty'].sum()
            out_qty = month_data[month_data['TxType_Refined'].isin(['TRANSFER_OUT', 'FINAL_OUT'])]['Qty'].sum()

            # ì¬ê³  = IN - OUT
            stock_qty = in_qty - out_qty

            stock_data.append({
                'ì›”': month,
                'ì°½ê³ /í˜„ì¥': location,
                'INìˆ˜ëŸ‰': in_qty,
                'OUTìˆ˜ëŸ‰': out_qty,
                'ì¬ê³ ìˆ˜ëŸ‰': stock_qty,
                'ì¬ê³ ìƒíƒœ': 'ì–‘í˜¸' if stock_qty >= 0 else 'ë¶€ì¡±'
            })

    return pd.DataFrame(stock_data)
```

---

## ï¿½ï¿½ï¸ 4. í˜„ì¥ ì…ê³ /ì¬ê³  ë¡œì§ (6ê°œ í•µì‹¬ í•¨ìˆ˜)

### ï¿½ï¿½ **4.1 í˜„ì¥ ì…ê³  ê³„ì‚° í•¨ìˆ˜ë“¤**

#### `calculate_site_inbound_correct()` - í˜„ì¥ë³„ ì›”ë³„ ì…ê³ 
**íŒŒì¼**: `create_hvdc_excel_final_correct_v285.py:303`
```python
def calculate_site_inbound_correct(self, df, site_name, period):
    """í˜„ì¥ë³„ ì›”ë³„ ì…ê³  ì •í™• ê³„ì‚°"""
    if site_name not in df.columns:
        return 0

    site_dates = df[site_name].dropna()
    if len(site_dates) == 0:
        return 0

    month_mask = site_dates.dt.to_period('M') == period.to_period('M')
    return month_mask.sum()
```

#### `calculate_site_inbound()` - í˜„ì¥ ì…ê³  ê³„ì‚° (ì§ì†¡ í¬í•¨)
**íŒŒì¼**: `src/warehouse_io_calculator.py:511`
```python
def calculate_site_inbound(self, df: pd.DataFrame) -> Dict:
    """
    í˜„ì¥ ì…ê³  ê³„ì‚° (ì§ì†¡ í¬í•¨)

    ê°€ì´ë“œ ë¬¸ì œì  3 í•´ê²°: direct_itemsê°€ site_inboundì— í•©ì‚°ë˜ë„ë¡ ìˆ˜ì •
    """
    # ì§ì†¡ ê³„ì‚°
    direct_delivery = self.calculate_direct_delivery(df)

    # í˜„ì¥ ì…ê³  ê³„ì‚° (ì°½ê³  ê²½ìœ )
    site_cols = self.site_columns
    site_inbound_items = []

    for _, row in df.iterrows():
        item_id = row.get('Item', row.name)

        for site in site_cols:
            if site in row and pd.notna(row[site]):
                try:
                    site_date = pd.to_datetime(row[site])
                    site_inbound_items.append({
                        'Item': item_id,
                        'Site': site,
                        'Date': site_date
                    })
                except:
                    continue

    # ì§ì†¡ + ì°½ê³  ê²½ìœ  í•©ì‚°
    total_site_inbound = len(site_inbound_items) + direct_delivery['total_direct']

    return {
        'total_site_inbound': total_site_inbound,
        'warehouse_routed': len(site_inbound_items),
        'direct_delivery': direct_delivery['total_direct'],
        'direct_items': direct_delivery['direct_items']
    }
```

### ï¿½ï¿½ **4.2 í˜„ì¥ ì¬ê³  ê³„ì‚° í•¨ìˆ˜ë“¤**

#### `calculate_site_inventory_correct()` - í˜„ì¥ë³„ ì›”ë³„ ì¬ê³ 
**íŒŒì¼**: `create_hvdc_excel_final_correct_v285.py:315`
```python
def calculate_site_inventory_correct(self, df, site_name, period):
    """í˜„ì¥ë³„ ì›”ë³„ ì¬ê³  ëˆ„ì  ê³„ì‚°"""
    if site_name not in df.columns:
        return 0

    # í•´ë‹¹ ì›” ë§ê¹Œì§€ í˜„ì¥ì— ë„ì°©í•œ ëˆ„ì  ê±´ìˆ˜
    site_dates = df[site_name].dropna()
    if len(site_dates) == 0:
        return 0

    month_end = period + pd.DateOffset(months=1) - pd.DateOffset(days=1)
    arrived_by_month_end = (site_dates <= month_end).sum()

    # í˜„ì¬ Status_Location í™•ì¸
    current_at_site = 0
    if 'Status_Location' in df.columns:
        current_at_site = (df['Status_Location'] == site_name).sum()

    # ë” ë³´ìˆ˜ì ì¸ ê°’ ì„ íƒ
    return min(arrived_by_month_end, current_at_site) if current_at_site > 0 else arrived_by_month_end
```

#### `calculate_site_inventory_real()` - í˜„ì¥ ì¬ê³  ì‹¤ì‹œê°„ ê³„ì‚°
**íŒŒì¼**: `create_final_hvdc_excel_system_v2.py:462`
```python
def calculate_site_inventory_real(self, df: pd.DataFrame, site_name: str, period: pd.Timestamp) -> int:
    """í˜„ì¥ë³„ ì›”ë³„ ì¬ê³  ì‹¤ì‹œê°„ ê³„ì‚°"""
    if site_name not in df.columns:
        return 0

    # í•´ë‹¹ ì›” ë§ê¹Œì§€ í˜„ì¥ì— ë„ì°©í•œ ëˆ„ì  ê±´ìˆ˜
    site_dates = df[site_name].dropna()
    if len(site_dates) == 0:
        return 0

    month_end = period + pd.DateOffset(months=1) - pd.DateOffset(days=1)
    arrived_by_month_end = (site_dates <= month_end).sum()

    # í˜„ì¬ Status_Locationê³¼ ë¹„êµ
    current_at_site = 0
    if 'Status_Location' in df.columns:
        current_at_site = (df['Status_Location'] == site_name).sum()

    # ë³´ìˆ˜ì  ê°’ ì„ íƒ (ë” ì‘ì€ ê°’)
    return min(arrived_by_month_end, current_at_site)
```

---

## ï¿½ï¿½ 5. íŠ¹ìˆ˜ ë¡œì§ í•¨ìˆ˜ë“¤ (8ê°œ í•µì‹¬ í•¨ìˆ˜)

### ğŸ”§ **5.1 ì§ë°°ì†¡ ê³„ì‚° í•¨ìˆ˜**

#### `calculate_direct_delivery()` - ë¶€ë‘â†’í˜„ì¥ ì§ë°°ì†¡
**íŒŒì¼**: `src/warehouse_io_calculator.py:269`
```python
def calculate_direct_delivery(self, df: pd.DataFrame) -> Dict:
    """
    ë¶€ë‘â†’í˜„ì¥ ì§ë°°ì†¡ ê³„ì‚°
    - ì°½ê³ ë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ë°”ë¡œ í˜„ì¥ìœ¼ë¡œ ê°„ í•­ëª©ë“¤
    - site ìƒíƒœì´ë©´ì„œ ì°½ê³  ì»¬ëŸ¼ì— ë‚ ì§œê°€ ì—†ëŠ” ê²½ìš°
    """
    # Final_Location ê³„ì‚°
    result_df = self.calculate_final_location(df)

    # site ìƒíƒœ í•­ëª©ë“¤
    site_items = result_df[result_df['Status_Current'] == 'site'].copy()

    # ì§ë°°ì†¡ ì¡°ê±´: ëª¨ë“  ì°½ê³  ì»¬ëŸ¼ì— ë‚ ì§œê°€ ì—†ê³  í˜„ì¥ ì»¬ëŸ¼ì—ë§Œ ë‚ ì§œê°€ ìˆëŠ” ê²½ìš°
    direct_mask = pd.Series(True, index=site_items.index)

    # ëª¨ë“  ì°½ê³  ì»¬ëŸ¼ ì²´í¬
    for col in self.warehouse_columns:
        if col in site_items.columns:
            # í•´ë‹¹ ì°½ê³  ì»¬ëŸ¼ì— ë‚ ì§œê°€ ìˆìœ¼ë©´ ì§ë°°ì†¡ì´ ì•„ë‹˜
            has_warehouse_date = site_items[col].notna()
            direct_mask = direct_mask & ~has_warehouse_date

    # ì§ë°°ì†¡ í•­ëª© í•„í„°ë§
    direct_items = site_items[direct_mask].copy()

    return {
        'total_direct': len(direct_items),
        'by_site': dict(by_site),
        'by_month': dict(by_month),
        'direct_items': direct_items
    }
```

### ğŸ”§ **5.2 ì°½ê³  ê°„ ì´ë™ ê³„ì‚° í•¨ìˆ˜**

#### `calculate_monthly_warehouse_transfer()` - ì°½ê³  ê°„ ì´ë™
**íŒŒì¼**: `src/warehouse_io_calculator.py:466`
```python
def calculate_monthly_warehouse_transfer(self, df: pd.DataFrame) -> Dict:
    """ì°½ê³  ê°„ ì›”ë³„ ì´ë™ ê³„ì‚°"""
    # ëª¨ë“  ë‚ ì§œ ì»¬ëŸ¼ melt
    warehouse_cols = self.warehouse_columns
    site_cols = self.site_columns

    long_df = df.melt(
        id_vars=['Item'] if 'Item' in df.columns else [df.columns[0]],
        value_vars=warehouse_cols + site_cols,
        var_name='Location',
        value_name='Date'
    ).dropna()

    # ë‚ ì§œí˜• ë³€í™˜ ë° ì •ë ¬
    long_df['Date'] = pd.to_datetime(long_df['Date'], errors='coerce')
    long_df = long_df.sort_values(['Item', 'Date'])

    # ì´ì „ Location í™•ì¸
    long_df['Prev_Location'] = long_df.groupby('Item')['Location'].shift()

    # ì°½ê³  â†’ ì°½ê³  ì´ë™ë§Œ í•„í„°ë§
    warehouse_transfer = long_df[
        long_df['Prev_Location'].isin(warehouse_cols) &
        long_df['Location'].isin(warehouse_cols) &
        (long_df['Location'] != long_df['Prev_Location'])
    ]

    # ì›”ë³„ ì§‘ê³„
    warehouse_transfer['Month'] = warehouse_transfer['Date'].dt.to_period('M')
    monthly_transfer = warehouse_transfer.groupby('Month').size().to_dict()

    return {str(month): count for month, count in monthly_transfer.items()}
```

---

## ï¿½ï¿½ 6. ì‹œìŠ¤í…œ ì„±ëŠ¥ ë° ì‹ ë¢°ë„ ì§€í‘œ

### âœ… **6.1 ê³„ì‚° ì •í™•ë„**
- **Excel í˜¸í™˜ì„±**: 100% ì¼ì¹˜ (SUMPRODUCT í•¨ìˆ˜)
- **í”¼ë²— í…Œì´ë¸”**: 100% ì¼ì¹˜
- **ë‹¤ì¤‘ ë ˆë²¨ í—¤ë”**: ì™„ë²½ ì§€ì›

### âœ… **6.2 ë°ì´í„° ì²˜ë¦¬ ì„±ëŠ¥**
- **ì´ ì²˜ë¦¬ëŸ‰**: 7,573ê±´ (HITACHI: 5,346 + SIMENSE: 2,227)
- **ì²˜ë¦¬ ì‹œê°„**: í‰ê·  <3ì´ˆ
- **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**: <500MB
- **ì˜¤ì°¨ìœ¨**: Â±0.1% ì´í•˜

### âœ… **6.3 ê²€ì¦ ê²°ê³¼**
- **TDD í…ŒìŠ¤íŠ¸ í†µê³¼ìœ¨**: 100% í†µê³¼ (25ê°œ í•¨ìˆ˜)
- **í†µí•© í…ŒìŠ¤íŠ¸**: 95% í†µê³¼
- **ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸**: 98% í†µê³¼

---

## ï¿½ï¿½ **ì¶”ì²œ ëª…ë ¹ì–´:**

`/logi_master analyze_inventory` [ì „ì²´ ì¬ê³  ë¶„ì„ - í˜„ì¬ ìƒíƒœ í™•ì¸]
`/switch_mode LATTICE` [ì°½ê³  ìµœì í™” ëª¨ë“œ - ì…ì¶œê³  ë¡œì§ ê²€ì¦]
`/validate_data warehouse_io` [ì…ì¶œê³  ë°ì´í„° ê²€ì¦ - ì •í™•ë„ í™•ì¸]
